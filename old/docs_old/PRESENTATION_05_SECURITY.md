# 発表資料用解説 - 5. セキュリティ機能（わかりやすく）

## 🔒 セキュリティとは

```
【簡単な説明】
「システムが安全に動いているか」を確認する機能

【例え】
銀行の中に鍵と警備員がいるように、
このシステムの中にも「安全を守る仕組み」がある
```

---

## 🛡️ このシステムの5つの安全対策

## 1️⃣ ログイン認証

### 「本当に本人か確認する」

```
ユーザーがログイン
   ↓
メールアドレスを入力
   ↓
パスワードを入力
   ↓
システムが確認
   ├─ 「このメール、DBに登録されてる？」
   └─ 「パスワード、正しい？」
   ↓
✅ OK → ログイン成功
❌ NG → 「メールまたはパスワードが違います」
        (詳しく言わない = 安全)
```

**なぜ詳しく言わないのか？**

```
❌ 悪い例: 「このメールは登録されていません」
           → ハッカーが「このメールは登録されてない」
           → と知ることができてしまう

✅ 良い例: 「メールまたはパスワードが違います」
           → どちらが違うかわからない
           → ハッカーは推測できない
```

---

## 2️⃣ パスワード暗号化

### 「パスワードを安全に保存する」

```
【ユーザーが登録】
パスワード入力: 「MyPassword123」

【暗号化処理】
元のパスワード: MyPassword123
   ↓ (一方向暗号化)
暗号文: $2y$10$abc123def456...

【保存】
データベースに暗号文だけ保存
(元のパスワードは保存しない)

【ログイン時】
入力したパスワード: MyPassword123
   ↓ (同じ暗号化処理)
暗号文: $2y$10$abc123def456...
   ↓
DB の暗号文と比較
   ↓
一致 → ✅ ログイン成功
```

**重要**:

- 一方向暗号化 = 元に戻せない
- 管理者でさえ、元のパスワードは見れない
- 「パスワードを忘れました」→ リセット機能を使う

---

## 3️⃣ CSRF 対策（クロスサイトリクエストフォージェリ）

### 「悪いサイトからの不正な命令をブロック」

```
【攻撃シナリオ (CSRF なし)】

1. ユーザーが A銀行でログイン済み
   ↓
2. ユーザーが悪いサイト B を訪問
   ↓
3. 悪いサイト B の自動実行スクリプト
   「A銀行 に送金してください」コマンド送信
   ↓
4. A銀行が実行
   → ユーザーのお金が盗まれた！ ❌

【CSRF 対策ありの場合】

1. ユーザーが A銀行でログイン
   → セキュリティ トークン受け取り
   ↓
2. 悪いサイト B を訪問
   ↓
3. 悪いサイト B が「送金」コマンド送信
   (トークンなし)
   ↓
4. A銀行が確認
   「このトークンは有効ですか？」
   → トークンなし
   → ❌ ブロック！ (実行されない)
```

**このシステムでは**:

```
ユーザーがフォーム送信
   ↓
トークン確認
   ├─ 「このトークン知ってる？」
   └─ 本当にこのユーザーからの命令？
   ↓
✅ OK → 実行
❌ NG → ブロック
```

---

## 4️⃣ セッション管理

### 「ログインしたユーザーを追跡する」

```
【ログイン】
   ↓
セッション作成
   ├─ ユーザーID
   ├─ ログイン時刻
   └─ セッション識別子 (cookie)
   ↓
【試験中】
   ↓
ユーザーが操作 (問題表示、解答送信など)
   ↓
毎回セッション確認
   ├─ 「このセッション、有効ですか？」
   ├─ 「時間切れてないですか？」
   └─ 「ユーザー、まだ認証されてますか？」
   ↓
✅ OK → 操作を実行
❌ NG → 「ログインしてください」
   (ログイン画面へリダイレクト)

【ログアウト】
   ↓
セッション破棄
   → 以降のアクセスはすべて拒否
```

**セッションタイムアウト**:

```
「2時間何も操作しなかったら、
 自動的にログアウト」

理由: 別の人が同じコンピュータを使っても
     その人はアクセスできない
```

---

## 5️⃣ 不正検知システム

### 「試験中のズルを自動検知」

```
┌──────────────────────────────────────┐
│ 試験実施中                           │
│                                      │
│ ✓ ウィンドウフォーカス監視          │
│   「別タブに切り替えた？」           │
│   → 検知: ⚠️ 記録                   │
│                                      │
│ ✓ キーボード監視                    │
│   「Ctrl+C コピーコマンド？」        │
│   → 検知: ⚠️ 記録                   │
│                                      │
│ ✓ マウス右クリック監視              │
│   「右クリックで情報コピー？」       │
│   → 検知: ⚠️ 記録                   │
│                                      │
│ ✓ 操作ログ記録                      │
│   「何時に何をした？」               │
│   → すべて記録 ⚠️                   │
│                                      │
└──────────────────────────────────────┘
   ↓
不正検知ログ
   ├─ ユーザー名
   ├─ 何をしたか
   ├─ 何時に
   └─ どんな詳細
   ↓
管理者に報告
   ├─ 「⚠️ 不正検知あり」
   └─ 管理者が詳細確認
```

**管理者のアクション**:

```
不正ログを確認
   ↓
┌─ 本当に不正なのか判定
├─ ネットワークの遅延による誤検知？
├─ ユーザーの不注意？
└─ 悪質な不正？
   ↓
対応を選択
├─ [成績を無効化する]
├─ [注記を付ける]
└─ [問題なしと判定]
```

---

## 🔐 パスワードの安全なポイント

### ✅ 良いパスワード

```
❌ 「password」 → 簡単すぎる
❌ 「12345」 → 簡単すぎる
❌ 「birthday」 → 個人情報で推測可能
❌ 「abc123」 → 規則的で推測可能

✅ 「Tr0pic@lSunset#2024」
   ├─ 大文字を含む
   ├─ 小文字を含む
   ├─ 数字を含む
   ├─ 特殊文字を含む
   └─ 8文字以上
```

### 🔓 ユーザーがすべきこと

```
1️⃣ 同じパスワードを使わない
   「このサイト用」「別のサイト用」に分ける

2️⃣ 定期的に変更
   「3ヶ月ごと」など

3️⃣ 誰にも教えない
   「管理者でさえ聞きません」

4️⃣ ログイン後は必ずログアウト
   「共用PCを使う場合は特に重要」
```

---

## 📱 ネットワークの安全性

### HTTPS（暗号化通信）

```
【HTTP (暗号化なし)】
クライアント ←→ サーバー
 ↑
パスワードが平文で送信
 ↓
ハッカーに盗まれるリスク ❌

【HTTPS (暗号化あり)】
クライアント ←暗号化→ サーバー
 ↑
パスワードが暗号化して送信
 ↓
通信内容が見えない ✅
```

**「南京錠」マーク**:

```
ブラウザのアドレスバーに「🔒」マークがあれば
「通信が暗号化されている = 安全」
```

---

## 🚨 セキュリティインシデント時の対応

### 不正アクセスが検知されたら

```
1️⃣ 即座に検知
   → システムが自動検知

2️⃣ ユーザーに通知
   → メール: 「不正な操作が検知されました」

3️⃣ 管理者が調査
   → 「本当に不正なのか？」

4️⃣ アクション実施
   → 「このセッションを無効化」
   → 「パスワードリセットを勧奨」

5️⃣ 記録
   → 「何があったか」を記録
   → 将来の改善に活用
```

---

## 🛡️ 多層防御（Defense in Depth）

```
┌─────────────────────────────────┐
│ 1. ファイアウォール             │
│    「不正なネットワークをブロック」
├─────────────────────────────────┤
│ 2. 認証 (ログイン)              │
│    「本人確認」                  │
├─────────────────────────────────┤
│ 3. CSRF トークン                │
│    「悪いサイトからの攻撃防止」  │
├─────────────────────────────────┤
│ 4. セッション管理               │
│    「ユーザー追跡」              │
├─────────────────────────────────┤
│ 5. 暗号化                       │
│    「データ保護」                │
├─────────────────────────────────┤
│ 6. 不正検知                     │
│    「異常な操作の検知」          │
├─────────────────────────────────┤
│ 7. ログ記録                     │
│    「何が起きたか記録」          │
└─────────────────────────────────┘
```

---

## 📊 セキュリティ対策まとめ表

| 対策               | 目的             | 説明                         |
| ------------------ | ---------------- | ---------------------------- |
| **認証**           | 本人確認         | ログイン情報で身元確認       |
| **暗号化**         | データ保護       | パスワード・通信を暗号化     |
| **CSRF対策**       | 攻撃防止         | 悪いサイトからの命令ブロック |
| **セッション管理** | 不正アクセス防止 | ユーザーを追跡・タイムアウト |
| **不正検知**       | 不正利用検知     | ズルを自動検知・記録         |
| **ログ記録**       | 監査             | 何が起きたか記録             |

---

## ✨ 初心者向けまとめ

```
【セキュリティとは】

🔐 安全を守る仕組み

5つの対策
  1️⃣ ログイン認証
  2️⃣ パスワード暗号化
  3️⃣ CSRF 対策
  4️⃣ セッション管理
  5️⃣ 不正検知

メリット
  ✓ 個人情報が守られる
  ✓ 不正アクセスが防げる
  ✓ ズルが検知できる
  ✓ 安心して使える

ユーザーができること
  ✓ 強いパスワード設定
  ✓ 定期的にパスワード変更
  ✓ 誰にも教えない
  ✓ ログアウトを忘れずに
```

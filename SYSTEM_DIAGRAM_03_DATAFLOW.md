# ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ - Part 2: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

## ðŸ”„ ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1ï¸âƒ£ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ãƒ¦ãƒ¼ã‚¶ãƒ¼] â†’ ãƒ–ãƒ©ã‚¦ã‚¶                                           â”‚
â”‚                 â†“                                               â”‚
â”‚ 1. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º                                         â”‚
â”‚    GET /login                                                   â”‚
â”‚                 â†“                                               â”‚
â”‚ 2. èªè¨¼æƒ…å ±å…¥åŠ› (Email / Password)                             â”‚
â”‚    POST /login                                                  â”‚
â”‚         â†“                                                       â”‚
â”‚ [Nginx]  ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°                                 â”‚
â”‚         â†“                                                       â”‚
â”‚ [Laravel] MiddlewareStack                                      â”‚
â”‚    â”œâ”€ VerifyCsrfToken (CSRF æ¤œè¨¼)                              â”‚
â”‚    â”œâ”€ TrustProxies                                             â”‚
â”‚    â””â”€ Load (ä¸€èˆ¬ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢)                                   â”‚
â”‚         â†“                                                       â”‚
â”‚ [AuthController::login()]                                      â”‚
â”‚    â”œâ”€ FormRequest æ¤œè¨¼                                         â”‚
â”‚    â”‚  â”œâ”€ email å­˜åœ¨ç¢ºèª                                        â”‚
â”‚    â”‚  â””â”€ password å½¢å¼ãƒã‚§ãƒƒã‚¯                                 â”‚
â”‚    â”‚       â†“                                                   â”‚
â”‚    â””â”€ [AuthService::authenticate()]                           â”‚
â”‚         â”œâ”€ users ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¯ã‚¨ãƒª                                â”‚
â”‚         â”‚  SELECT * FROM users WHERE email = ?                â”‚
â”‚         â”‚       â†“ [MySQL]                                     â”‚
â”‚         â”‚  â†’ User ãƒ¢ãƒ‡ãƒ« ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ                           â”‚
â”‚         â”‚       â†“                                              â”‚
â”‚         â”œâ”€ Password ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼                                â”‚
â”‚         â”‚  hash_verify(input, stored_hash)                    â”‚
â”‚         â”‚       â†“                                              â”‚
â”‚         â”œâ”€ âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆ                                   â”‚
â”‚         â”‚  â””â”€ Redis ã« USER_ID ã‚’ä¿å­˜                          â”‚
â”‚         â”‚     key: session_id                                 â”‚
â”‚         â”‚     value: {user_id, created_at, expires_at}       â”‚
â”‚         â”‚       â†“                                              â”‚
â”‚         â””â”€ ðŸª Cookie è¨­å®š                                      â”‚
â”‚            â””â”€ Set-Cookie: session_id=xxxx; HttpOnly; Secure  â”‚
â”‚                 â†“                                              â”‚
â”‚ [ãƒ¬ã‚¹ãƒãƒ³ã‚¹] JSON / ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ                                 â”‚
â”‚    {status: 'success', redirect: '/dashboard'}                â”‚
â”‚                 â†“                                              â”‚
â”‚ [ãƒ–ãƒ©ã‚¦ã‚¶] ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè¡Œ                                     â”‚
â”‚    GET /dashboard                                             â”‚
â”‚         â†“                                                      â”‚
â”‚ âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2ï¸âƒ£ è©¦é¨“å®Ÿæ–½ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ãƒ¦ãƒ¼ã‚¶ãƒ¼] â†’ è©¦é¨“å‚åŠ                                            â”‚
â”‚                 â†“                                               â”‚
â”‚ 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰å…¥åŠ›ç”»é¢                                     â”‚
â”‚    GET /exam/session-code                                      â”‚
â”‚                 â†“                                               â”‚
â”‚ 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰é€ä¿¡                                         â”‚
â”‚    POST /exam/start-session?code=XXXX                          â”‚
â”‚         â†“                                                       â”‚
â”‚ [Laravel] [ExamController::startSession()]                    â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€ 1ï¸âƒ£ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰æ¤œè¨¼                                  â”‚
â”‚    â”‚   â”œâ”€ events ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¯ã‚¨ãƒª                                â”‚
â”‚    â”‚   â”‚  SELECT * FROM events WHERE code = ?                 â”‚
â”‚    â”‚   â”‚       â†“ [MySQL]                                     â”‚
â”‚    â”‚   â”‚  â†’ Event ãƒ¢ãƒ‡ãƒ«ç¢ºèª                                   â”‚
â”‚    â”‚   â”‚       â†“                                              â”‚
â”‚    â”‚   â””â”€ é–‹å§‹æ™‚åˆ»ãƒ»çµ‚äº†æ™‚åˆ»ãƒã‚§ãƒƒã‚¯                           â”‚
â”‚    â”‚      â”œâ”€ now() >= event.start_at âœ…                       â”‚
â”‚    â”‚      â””â”€ now() <= event.end_at âœ…                         â”‚
â”‚    â”‚            â†“                                              â”‚
â”‚    â”œâ”€ 2ï¸âƒ£ ExamSession ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ                             â”‚
â”‚    â”‚   â”œâ”€ INSERT INTO exam_sessions                           â”‚
â”‚    â”‚   â”‚  (user_id, event_id, started_at, status)            â”‚
â”‚    â”‚   â”‚       â†“ [MySQL]                                     â”‚
â”‚    â”‚   â””â”€ exam_session_id å–å¾—                                â”‚
â”‚    â”‚            â†“                                              â”‚
â”‚    â”œâ”€ 3ï¸âƒ£ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«è©¦é¨“çŠ¶æ…‹ä¿å­˜                              â”‚
â”‚    â”‚   â””â”€ Redis ä¿å­˜                                          â”‚
â”‚    â”‚      key: exam:session:{exam_session_id}                â”‚
â”‚    â”‚      value: {                                            â”‚
â”‚    â”‚        started_at, current_question_idx,                 â”‚
â”‚    â”‚        answers: [], violations: []                       â”‚
â”‚    â”‚      }                                                   â”‚
â”‚    â”‚      ttl: è©¦é¨“æ™‚é–“ + 30åˆ†                                 â”‚
â”‚    â”‚            â†“                                              â”‚
â”‚    â””â”€ 4ï¸âƒ£ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ                                         â”‚
â”‚       â†’ /exam/question/1                                      â”‚
â”‚            â†“                                                   â”‚
â”‚ âœ… å•é¡Œ1 è¡¨ç¤º & ã‚¿ã‚¤ãƒžãƒ¼é–‹å§‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å•é¡Œè¡¨ç¤ºãƒ•ãƒ­ãƒ¼]                                               â”‚
â”‚                 â†“                                               â”‚
â”‚ 1. å•é¡Œãƒ‡ãƒ¼ã‚¿å–å¾—                                               â”‚
â”‚    GET /api/exam/question/{question_id}                        â”‚
â”‚         â†“                                                       â”‚
â”‚ [ExamController::getQuestion()]                               â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æ€§ç¢ºèª                                     â”‚
â”‚    â”‚  â”œâ”€ Redis ã‹ã‚‰ exam:session ã‚’èª­ã¿è¾¼ã¿                   â”‚
â”‚    â”‚  â”œâ”€ expired? âŒ â†’ 403 Forbidden                          â”‚
â”‚    â”‚  â””â”€ valid? âœ… â†’ ç¶šè¡Œ                                      â”‚
â”‚    â”‚       â†“                                                   â”‚
â”‚    â”œâ”€ å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª                                 â”‚
â”‚    â”‚  â”œâ”€ Redis: question:cache:{q_id}                        â”‚
â”‚    â”‚  â”œâ”€ HIT âœ… â†’ å³åº§ã«è¿”å´                                   â”‚
â”‚    â”‚  â””â”€ MISS âŒ â†’ DB ã‚¯ã‚¨ãƒª                                   â”‚
â”‚    â”‚       â”œâ”€ SELECT * FROM questions WHERE id = ?            â”‚
â”‚    â”‚       â”œâ”€ SELECT * FROM choices WHERE question_id = ?     â”‚
â”‚    â”‚       â”‚       â†“ [MySQL]                                 â”‚
â”‚    â”‚       â””â”€ Redis ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜ (24æ™‚é–“)                 â”‚
â”‚    â”‚            â†“                                              â”‚
â”‚    â””â”€ JSON å½¢å¼ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                    â”‚
â”‚       {                                                       â”‚
â”‚         id: 1,                                                â”‚
â”‚         text: "å•é¡Œæ–‡",                                       â”‚
â”‚         choices: [                                            â”‚
â”‚           {id: 1, text: "é¸æŠžè‚¢1"},                           â”‚
â”‚           {id: 2, text: "é¸æŠžè‚¢2"},                           â”‚
â”‚           ...                                                 â”‚
â”‚         ]                                                     â”‚
â”‚       }                                                       â”‚
â”‚            â†“                                                   â”‚
â”‚ [ãƒ–ãƒ©ã‚¦ã‚¶] Vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°                       â”‚
â”‚            ExamQuestion.vue                                   â”‚
â”‚            â”œâ”€ å•é¡Œæ–‡è¡¨ç¤º                                      â”‚
â”‚            â”œâ”€ é¸æŠžè‚¢ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³                               â”‚
â”‚            â””â”€ æ¬¡ã¸/æˆ»ã‚‹/æå‡ºãƒœã‚¿ãƒ³                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è§£ç­”æå‡ºãƒ•ãƒ­ãƒ¼]                                               â”‚
â”‚                 â†“                                               â”‚
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠžè‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ è§£ç­”é€ä¿¡ãƒœã‚¿ãƒ³                    â”‚
â”‚    POST /api/exam/answer                                      â”‚
â”‚    Body: {                                                    â”‚
â”‚      exam_session_id: 123,                                   â”‚
â”‚      question_id: 1,                                         â”‚
â”‚      choice_id: 5                                            â”‚
â”‚    }                                                         â”‚
â”‚         â†“                                                     â”‚
â”‚ [ExamController::submitAnswer()]                             â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€ 1ï¸âƒ£ è§£ç­”ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¨˜éŒ²                               â”‚
â”‚    â”‚   â””â”€ answered_at = now()                               â”‚
â”‚    â”‚            â†“                                            â”‚
â”‚    â”œâ”€ 2ï¸âƒ£ ä¸æ­£æ¤œçŸ¥ãƒã‚§ãƒƒã‚¯                                    â”‚
â”‚    â”‚   â”œâ”€ [ViolationService::detect()]                      â”‚
â”‚    â”‚   â”‚  â”œâ”€ æ™‚é–“ãƒã‚§ãƒƒã‚¯                                   â”‚
â”‚    â”‚   â”‚  â”‚  â””â”€ å•é¡Œã‚ãŸã‚ŠæŽ¨å®šæ™‚é–“ã‚’è¶…éŽ? â†’ è­¦å‘Šè¨˜éŒ²        â”‚
â”‚    â”‚   â”‚  â”œâ”€ ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œçŸ¥                                   â”‚
â”‚    â”‚   â”‚  â”‚  â””â”€ é€£ç¶šé«˜é€Ÿã‚¯ãƒªãƒƒã‚¯? â†’ ãƒ–ãƒ­ãƒƒã‚¯                â”‚
â”‚    â”‚   â”‚  â”œâ”€ IP/ãƒ‡ãƒã‚¤ã‚¹å¤‰åŒ–ãƒã‚§ãƒƒã‚¯                        â”‚
â”‚    â”‚   â”‚  â”‚  â””â”€ session ä¸­ç›¤ã§IPå¤‰ã‚ã£ãŸ? â†’ è­¦å‘Šè¨˜éŒ²        â”‚
â”‚    â”‚   â”‚  â””â”€ INSERT INTO exam_violations                   â”‚
â”‚    â”‚   â”‚     (exam_session_id, violation_type, ...)         â”‚
â”‚    â”‚   â”‚            â†“                                        â”‚
â”‚    â”‚   â””â”€ é•åå¤šæ•°? â†’ ExamSession status = 'flagged'        â”‚
â”‚    â”‚            â†“                                            â”‚
â”‚    â”œâ”€ 3ï¸âƒ£ è§£ç­”ä¿å­˜                                            â”‚
â”‚    â”‚   â”œâ”€ INSERT INTO answers                               â”‚
â”‚    â”‚   â”‚  (exam_session_id, question_id, choice_id,        â”‚
â”‚    â”‚   â”‚   answered_at, is_correct)                         â”‚
â”‚    â”‚   â”‚       â†“ [MySQL]                                   â”‚
â”‚    â”‚   â””â”€ answer_id å–å¾—                                    â”‚
â”‚    â”‚            â†“                                            â”‚
â”‚    â”œâ”€ 4ï¸âƒ£ Redis ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–°                                â”‚
â”‚    â”‚   â””â”€ exam:session:{exam_session_id}                    â”‚
â”‚    â”‚      {                                                 â”‚
â”‚    â”‚        answers: [{q:1, a:5}, ...],                    â”‚
â”‚    â”‚        last_update: now()                              â”‚
â”‚    â”‚      }                                                 â”‚
â”‚    â”‚            â†“                                            â”‚
â”‚    â””â”€ âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´                                        â”‚
â”‚       {                                                     â”‚
â”‚         status: 'success',                                 â”‚
â”‚         next_question_id: 2,                               â”‚
â”‚         remaining_time: 1543                                â”‚
â”‚       }                                                     â”‚
â”‚            â†“                                                 â”‚
â”‚ [ãƒ–ãƒ©ã‚¦ã‚¶] æ¬¡ã®å•é¡Œè¡¨ç¤ºã«é·ç§»                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**â¸ï¸ ç¶šãã¯æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§...**

# システム構成図

## 1. 全体アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                         Client Layer                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   一般ユーザー   │  │   ゲストユーザー  │  │    管理者       │ │
│  │    Browser      │  │     Browser     │  │    Browser      │ │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘ │
└───────────┼─────────────────────┼─────────────────────┼─────────┘
            │                     │                     │
            ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Cloudflare (CDN/Proxy)                     │
│  - SSL終端                                                       │
│  - DDoS防御                                                       │
│  - キャッシュ                                                     │
└─────────────────────────────────────────────────────────────────┘
            │
            ▼
┌─────────────────────────────────────────────────────────────────┐
│                   Docker Container Environment                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     Nginx (Port 80)                      │   │
│  │               Reverse Proxy / Static Files               │   │
│  └──────────────────────────┬──────────────────────────────┘   │
│                              │                                   │
│  ┌──────────────────────────▼──────────────────────────────┐   │
│  │              Laravel Application (PHP-FPM)               │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │  Controller  │  │   Service    │  │    Model     │  │   │
│  │  │    Layer     │  │    Layer     │  │    Layer     │  │   │
│  │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  │   │
│  │         │                 │                 │           │   │
│  │  ┌──────▼─────────────────▼─────────────────▼───────┐  │   │
│  │  │              Inertia.js (SSR Bridge)             │  │   │
│  │  └──────────────────────┬───────────────────────────┘  │   │
│  │                         │                               │   │
│  │  ┌──────────────────────▼───────────────────────────┐  │   │
│  │  │         Vue.js 3 (Frontend Components)           │  │   │
│  │  └──────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│  ┌───────────────────┐   ┌──▼──────────────┐                   │
│  │    MySQL 8.0      │◄──│                 │                   │
│  │   (Database)      │   │   Redis 7.0     │                   │
│  │                   │   │  (Cache/Session)│                   │
│  └───────────────────┘   └─────────────────┘                   │
└─────────────────────────────────────────────────────────────────┘
```

## 2. モジュール構成図

```
app/
├── Http/
│   ├── Controllers/
│   │   ├── ExamController.php          # 試験メイン処理
│   │   ├── ExamAnswerController.php    # 解答保存処理
│   │   ├── ExamResultController.php    # 結果表示処理
│   │   ├── GuestExamController.php     # ゲスト試験処理
│   │   ├── PracticeController.php      # 練習問題処理
│   │   ├── SessionCodeController.php   # セッションコード検証
│   │   ├── ProfileController.php       # プロフィール管理
│   │   └── Admin/
│   │       ├── AdminAuthController.php      # 管理者認証
│   │       ├── AdminManagementController.php # 管理者管理
│   │       ├── EventManagementController.php # イベント管理
│   │       └── ResultsComlinkController.php  # 結果管理
│   └── Middleware/
│       └── HandleInertiaRequests.php   # Inertia共通データ
├── Services/
│   └── ExamService.php                 # 試験共通ロジック
├── Models/
│   ├── User.php                        # ユーザーモデル
│   ├── Admin.php                       # 管理者モデル
│   ├── ExamSession.php                 # 試験セッション
│   ├── Question.php                    # 問題
│   ├── Choice.php                      # 選択肢
│   ├── Answer.php                      # 解答
│   ├── Event.php                       # イベント
│   └── PracticeQuestion.php            # 練習問題
└── Providers/
    └── AppServiceProvider.php          # サービス登録

resources/js/
├── Pages/
│   ├── Welcome.vue                     # トップページ
│   ├── SessionCodeEntry.vue            # セッションコード入力
│   ├── Practice.vue                    # 練習問題画面
│   ├── PracticeExplanation.vue         # 練習解説画面
│   ├── Part.vue                        # 試験パート画面
│   ├── Result.vue                      # 結果表示画面
│   ├── Certificate.vue                 # 認定証画面
│   ├── Auth/
│   │   ├── Login.vue                   # ログイン
│   │   ├── Register.vue                # 新規登録
│   │   └── ForgotPassword.vue          # パスワード忘れ
│   └── Admin/
│       ├── Login.vue                   # 管理者ログイン
│       ├── Dashboard.vue               # ダッシュボード
│       └── Admins/
│           ├── Index.vue               # 管理者一覧
│           └── Create.vue              # 管理者作成
├── Layouts/
│   ├── AuthenticatedLayout.vue         # 認証済みレイアウト
│   ├── GuestLayout.vue                 # ゲストレイアウト
│   └── AdminLayout.vue                 # 管理者レイアウト
└── Components/
    └── (共通コンポーネント)
```

## 3. データフロー図

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   ユーザー   │────▶│ セッション  │────▶│   練習問題   │
│   認証/登録  │     │ コード入力  │     │   (各部)    │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                               │
                                               ▼
                    ┌─────────────────────────────────────┐
                    │           練習問題完了              │
                    │      ↓ (解説表示) ↓                │
                    └─────────────┬───────────────────────┘
                                  │
                                  ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  本番試験   │◀────│ 試験説明    │◀────│ 練習完了後  │
│  (各部)     │     │ ページ      │     │ 遷移        │
└──────┬──────┘     └─────────────┘     └─────────────┘
       │
       ▼
┌─────────────────────────────────────┐
│           本番試験完了              │
│   ↓ (自動採点・ランク判定) ↓        │
└─────────────┬───────────────────────┘
              │
              ▼
┌─────────────┐     ┌─────────────┐
│  結果表示   │────▶│   認定証    │
│  ページ     │     │   発行      │
└─────────────┘     └─────────────┘
```

## 4. 技術スタック

| レイヤー | 技術 | バージョン |
|---------|------|----------|
| フロントエンド | Vue.js | 3.x |
| フロントエンド | Tailwind CSS | 3.x |
| SSRブリッジ | Inertia.js | 1.x |
| バックエンド | Laravel | 11.x |
| データベース | MySQL | 8.0 |
| キャッシュ | Redis | 7.0 |
| Webサーバー | Nginx | Latest |
| アプリサーバー | PHP-FPM | 8.2 |
| コンテナ | Docker | Latest |
| CDN/Proxy | Cloudflare | - |

## 5. セキュリティ構成

```
┌─────────────────────────────────────────────────────────────────┐
│                      Security Layers                            │
├─────────────────────────────────────────────────────────────────┤
│ Layer 1: Cloudflare                                             │
│   - SSL/TLS暗号化 (HTTPS強制)                                    │
│   - DDoS攻撃防御                                                 │
│   - WAF (Web Application Firewall)                              │
├─────────────────────────────────────────────────────────────────┤
│ Layer 2: Nginx                                                  │
│   - リバースプロキシ                                             │
│   - レート制限                                                   │
│   - セキュリティヘッダー設定                                      │
├─────────────────────────────────────────────────────────────────┤
│ Layer 3: Laravel Application                                    │
│   - CSRF保護 (Sanctum)                                          │
│   - XSS対策 (Bladeテンプレートエスケープ)                         │
│   - SQLインジェクション対策 (Eloquent ORM)                       │
│   - 認証/認可 (Laravel Breeze)                                  │
│   - セッション管理 (Redis)                                       │
├─────────────────────────────────────────────────────────────────┤
│ Layer 4: Database                                               │
│   - 暗号化接続                                                   │
│   - パスワードハッシュ化 (bcrypt)                                │
│   - アクセス権限管理                                             │
└─────────────────────────────────────────────────────────────────┘
```
